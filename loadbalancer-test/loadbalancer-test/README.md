#Cheetah Test

This is a repo to test [cheetah](https://bitbucket.org/nslab/cheetah-click/src/cheetah/) load balancer.  
The basic idea is to generate files whose sizes are set according to the information extracted from a trace captured at [KTH](https://www.kth.se/). Then use [wrk](https://github.com/tbarbette/wrk) and [lua](https://www.lua.org) to download these files.  
Wrk and Lua script is from [friskfly](https://gist.github.com/friskfly/73a1b926cf793a3b3afa).


##How to Use

1. Prepare files   
```./flsz_.csv``` is the original data. ```./file.csv``` is a small part of ```./flsz_.csv``` and just for testing.

2. Generate files at ```./```   
In ```./```   
Run:
    ```
    ./server.sh -f [filename]
    ```   
Example:
    ```
    ./server.sh -f file.csv
    ```   
Then files will be generated at ```./fileResult``` folder. The name of each file is its size.   
3. Run mininet
In ```./```   
Run:
    ```
    sudo python topo.py http
    ```   
or
    ```
    sudo python topo.py
    ```   

The first command will start http servers directy and the for the second one you have to start the servers by yourselves.   
4. Start click   
In ```../../cheetah-click``` run:  
    ```
    gdb --args bin/click --dpdk -w 0000:17:00.0 -w 0000:17:00.1 -l 0-0 --vdev=eth_af_packet0,iface=s1-eth2 --vdev=eth_af_packet1,iface=s1-eth1 -- conf/cheetah/cheetah.click macright=92:08:01:87:04:6d macleft=6e:e9:dc:f5:3d:5b verbose=3
    ```   
5. In the mininet window run:   
    ```
    xterm h1
    ```  
Then in h1   
Run:
    ```
    ./client.sh -f [filename] -c [#connections] -t [#threads] -d [durationTime] -s [serverIP]
    ```  

-f : Filename which contains the required size for each file  
-c : Number of connections generated by wrk  
-t : Number of threads generated by wrk  
-d : Duration time of testing  
-s : Target server IP  

Example:
    ```
    ./client.sh -f file.csv -c 10 -t 5 -d 10 -s http://10.220.0.1
    ```   
In this example, we will initialize 10 connections from 5 threads to http://10.220.0.1 and start to download files accroding to the data from  ```file.csv```. The test will last 10 seconds.  


